unmarked_tree {
  x = nil => unmarked_tree(x) |
  x != nil * f' = nil * x->f',c',l',r' * unmarked_tree(l') * unmarked_tree(r') => unmarked_tree(x)
};

marked_tree {
  x = nil => marked_tree(x) |
  x != nil * f' != nil * x->f',c',l',r' * marked_tree(l') * marked_tree(r') => marked_tree(x)
};

stack {
  x = nil => stack(x) |
  x != nil * f' != nil * c' = nil * x->f',c',l',r' * stack(l') * unmarked_tree(r') => stack(x) |
  x != nil * f' != nil * c' != nil * x->f',c',l',r' * stack(r') * marked_tree(l') => stack(x)
};

loop_invariant {
  t = nil * stack(p) => loop_invariant(t,p) |
  t != nil * f' = nil * t->f',c',l',r' * unmarked_tree(l') * unmarked_tree(r') * stack(p) => loop_invariant(t,p) |
  t != nil * f' != nil * t->f',c',l',r' * marked_tree(l') * marked_tree(r') * stack(p) => loop_invariant(t,p)
};

loop_invariant2 {
  t = nil * stack(p) => loop_invariant2(t,p) |
  t != nil * unmarked_tree(t) * stack(p) => loop_invariant2(t,p) |
  t != nil * marked_tree(t) * stack(p) => loop_invariant2(t,p)
};

tree {
  unmarked_tree(x) => tree(x) |
  marked_tree(x) => tree(x)
};

loop_invariant3 {
  stack(p) * tree(t) => loop_invariant3(t,p)
}